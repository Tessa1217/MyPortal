<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.project.portal.tempcourse.service.TempcourseMapper">
<sql id="criteria">
		<where>
		<if test="cri.keyword != null and cri.keyword != ''">
			 ${cri.type} = ${cri.keyword}
		</if>
		</where>
</sql>
	<select id="getInfo" resultType="ProfessorVO">
		select depart_code, professor_id
		from professor where professor_id = #{professorId}

	</select>
	
	

	<select id="tempcourseList"
		resultType="com.project.portal.tempcourse.service.TempcourseVO">

		select *
		from temp_course
		 <!-- where course_code =#{courseCode} -->
		
		<include refid="criteria"></include>
		
		
	</select>

	<select id="tempcourseweekList" resultType="com.project.portal.tempcourse.service.TempcourseweekVO">
		select * from temp_course_weekly
	</select>

	<select id="tempcourseListCount" resultType="int">
		select count(*)
		from temp_course
		
	<include refid="criteria"></include>
	</select>

	<select id="getTemp"
		resultType="com.project.portal.tempcourse.service.TempcourseVO">
		<!-- select w.week_num, w.week_content, w.course_code, w.weekCode -->
		<!-- select *
		from temp_course_weekly w
		join temp_course k
		on w.course_code = k.course_code
		where course_code = #{courseCode} -->
		
		select * from temp_course where course_code = #{courseCode}
	</select>
	
	<select id="getTempweek" resultType="com.project.portal.tempcourse.service.TempcourseweekVO">
		
		select week_num, week_content, course_code from temp_course_weekly where course_code = #{courseCode}
	
	
	</select>

	<insert id="tempInsert">
		<selectKey resultType="string" keyProperty="courseCode"
			order="BEFORE">
			select SUBSTR(CONCAT(c.college_code, d.depart_code), 1,
			4)||LPAD(TO_CHAR(seq_en.nextval), 4, '0') from
			college c join
			department d
			on c.college_code = d.college_code where d.depart_code =
			#{departCode}
		</selectKey>
		insert into temp_course(
		course_name,
		course_code,
		course_sortation,
		course_credit,
		report_assigned_score,
		att_assigned_score,
		midterm_assigned_score,
		final_assigned_score,
		course_limit,
		textbook_reference,
		course_summary,
		course_notes,
		depart_code,
		course_year,
		course_semester,
		professor_id

		)
		values(
		#{courseName},
		#{courseCode},
		#{courseSortation},
		#{courseCredit},
		#{reportAssignedScore},
		#{attAssignedScore},
		#{midtermAssignedScore},
		#{finalAssignedScore},
		#{courseLimit},
		#{textbookReference},
		#{courseSummary},
		#{courseNotes},
		#{departCode},
		#{courseYear},
		#{courseSemester},
		#{professorId}
		)

	</insert>

	<insert id="tempweekInsert">

		 insert into temp_course_weekly(
		week_num,
		week_content,
		week_code,
		course_code
		)
		values
		( 
		#{weekNum},
		#{weekContent},
		#{courseCode}||LPAD(TO_CHAR(#{weekNum}), 2, '0'),
		#{courseCode}
		)
		<!-- <foreach collection="list" item="item" separator=" " open="INSERT ALL" close="SELECT * FROM dual">
		into temp_course_weekly
		(
		week_num,
		week_content,
		week_code,
		course_code
		values
		)
		(
		#{item.weekNum},
		#{item.weekContent},
		#{item.courseCode}||LPAD(TO_CHAR(#{item.weekNum}), 2, '0'),
		#{item.courseCode}
		)
		</foreach> -->
	</insert>
	
	<update id="updateTemp" parameterType="com.project.portal.tempcourse.service.TempcourseVO">
		update  temp_course
		   set  course_name = #{courseName}, 
				course_year = #{courseYear}, 
				course_sortation = #{courseSortation},
				course_semester = #{courseSemester}, 
				course_credit = #{courseCredit},
				report_assigned_score = #{reportAssignedScore}, 
				midterm_assigned_score= #{midtermAssignedScore},
				final_assigned_score = #{finalAssignedScore}, 
				course_limit = #{courseLimit},
				textbook_reference = #{textbookReference}, 
				course_summary = #{courseSummary},
				course_notes = #{courseNotes}
		 where  course_code = #{courseCode}
		
	</update>
	
	<update id="updateweekTemp" parameterType="com.project.portal.tempcourse.service.TempcourseweekVO">
		 update  temp_course_weekly
			set	week_content = #{weekContent}
			where course_code = #{courseCode}
			
	
	</update>
	
	 <update id="submitTemp" parameterType="com.project.portal.tempcourse.service.TempcourseVO">
	
		update temp_course
		set submit_yes = #{submitYes}, back_reason = #{backReason}
		where course_code = #{courseCode}
	</update> 
</mapper>