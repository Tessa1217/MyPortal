<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/professor_layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<th:block layout:fragment="professorContent">
		<div id="main">
			<div class="container">
				<h1>시험 문제</h1>
			</div>
			<div class="container">
				<div class="row justify-content-center">
					<th:block
						th:each="num : ${#numbers.sequence(1, exam.examTotalQuestion)}">
						<div class="col-12 col-md-6">
							<div th:id="${num}" class="card" style="height: 200px;">
								<button type="button" class="addBtn btn btn-outline-primary"
									data-toggle="modal" data-target="#addQuestionModal"
									style="height: 200px;">
									<svg class="svg-inline--fa fa-plus fa-w-14 fa-fw select-all"
										aria-hidden="true" focusable="false" data-prefix="fas"
										data-icon="plus" role="img" xmlns="http://www.w3.org/2000/svg"
										viewBox="0 0 448 512" data-fa-i2svg="">
										<path fill="currentColor"
											d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z">
							</path></svg>
								</button>
							</div>
						</div>
						<div th:if="${num}%2==0" class="w-100"></div>
					</th:block>
				</div>
			</div>
			<div id="qFormat" style="visibility: hidden;">
				<p></p>
				<ul>
					<li></li>
					<li></li>
					<li></li>
					<li></li>
				</ul>
			</div>
			<div class="modal fade" id="addQuestionModal" tabindex="-1"
				role="dialog" aria-labelledby="exampleModalCenterTitle"
				aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalLabel">문제를 입력해주세요.</h5>
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<form>
								<div class="form-group">
									<input id="whichModal" hidden=""> <label
										for="questionContent">Question:</label><input type="text"
										id="questionContent">
								</div>
								<th:block th:each="num : ${#numbers.sequence(1, 4)}">
									<div class="form-group">
										<label th:for="|option${num}|">[[${num}]]</label> <input
											type="text" th:id="|option${num}|"> <input
											type="radio" th:id="${num}" name="answer">
									</div>
								</th:block>
							</form>
						</div>
						<div class="modal-footer">
							<button id="closeModal" type="button" class="btn btn-secondary"
								data-dismiss="modal">Close</button>
							<button id="submitModal" type="button" class="btn btn-primary">Submit</button>
						</div>
					</div>
				</div>
			</div>

		</div>
		<script th:inline="javascript">
		$(function() {
			addQuestion();
			modalOff();
			makeQuestion();
		});
		
		// 문제 생성용 모달창 오픈
		function addQuestion() {
			$(".row").on("click", "button", (e) => {
				let modalLocation = $(e.target).parent().attr('id');
				$('#addQuestionModal').modal('show');
				$("#whichModal").val(modalLocation);
			})
		}
		
		// 모달창 끄기 버튼
		function modalOff() {
			$("#closeModal").on("click", function() {
				$('#addQuestionModal').modal('hide');
			})
		}
		
		// 문제 생성하여 빈 div에 값넣고 클론하여 해당 위치의 카드로 옮기기 
		function makeQuestion() {
			$("#submitModal").on("click", function() {
				let q = $("#qFormat").children();
				let li = $(q[1]).children();
				$(q[0]).text($("#questionContent").val());
				$(li[0]).text($("#option1").val());
				$(li[1]).text($("#option2").val());
				$(li[2]).text($("#option3").val())
				$(li[3]).text($("#option4").val())			
				$('#' + $("#whichModal").val()).empty().append($("#qFormat").clone().css('visibility', 'visible'));
				document.querySelectorAll("#addQuestionModal input").forEach(val => {
					val.value = '';
				});
				$("#closeModal").trigger("click");
			})
		}
		</script>
	</th:block>
</body>
</html>