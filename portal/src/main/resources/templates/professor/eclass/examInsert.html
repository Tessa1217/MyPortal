<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/professor-eclass_layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
.offPage {
	display: none;
}

.scroll {
	overflow: scroll;
	height: 600px;
}

.card {
	padding: 3%;
}
</style>
</head>
<body>
	<th:block layout:fragment="professorEclassContent">
		<div id="main">
			<div>
				<div class="row">
					<div class="page-title">
						<h2>시험 생성하기</h2>
					</div>
					<div class="right">
						<input id="tab1" type="radio" name="tabs" checked> <label
							for="tab1" class="tabmenu">시험 기본 정보</label> <input id="tab2"
							type="radio" name="tabs"> <label for="tab2"
							class="tabmenu">시험지 정보 불러오기</label> <input id="tab3" type="radio"
							name="tabs"> <label for="tab3" class="tabmenu">시험
							문제 생성하기</label>
					</div>
					<div class="card paging">
						<div class="card-header">
							<h4>시험 기본 정보</h4>
						</div>
						<div class="card-body" align="center">
							<form id="examInfoForm" class="form form-horizontal">
								<div class="form-body">
									<div class="row inputBox">
										<div class="col-md-4">
											<label>강의 코드</label>
										</div>
										<div class="col-md-8 form-group">
											<input type="text" class="form-control" readonly name="courseCode"
											th:value="${courseInfo.courseCode}">
										</div>
										<div class="col-md-4">
											<label>강의 년도</label>
										</div>
										<div class="col-md-8 form-group">
											<input type="number" class="form-control" readonly name="courseYear"
											th:value="${courseInfo.courseYear}">
										</div>
										<div class="col-md-4">
											<label>강의 학기</label>
										</div>
										<div class="col-md-8 form-group">
											<input type="number" class="form-control" readonly name="courseSemester"
											th:value="${courseInfo.courseSemester}">
										</div>
										<div class="col-md-4">
											<label>시험 종류</label>
										</div>
										<div class="col-md-8 form-group">
										<select class="form-select" name="examCode">
												<option value="">시험 종류를 선택해주세요.</option>
												<option value="M">중간</option>
												<option value="F">기말</option>
										</select>
										</div>
										<div class="col-md-4">
											<label>시험 주차</label>
										</div>
										<div class="col-md-8 form-group">
										<select class="form-select" name="weekCode">
												<option value="">주차를 선택해주세요.</option>
												<th:block th:each="week : ${courseInfo.weekPlans}">
													<option th:data-start="${#dates.format(week.weekStartDate, 'yyyy-MM-dd')}"
													th:data-end="${#dates.format(week.weekEndDate, 'yyyy-MM-dd')}"
													th:value="${week.weekCode}">[[${week.weekNum}]]주차</option>
												</th:block>
										</select>
										</div>
										<div class="col-md-4">
											<label>시험 시작일</label>
										</div>
										<div class="col-md-8 form-group">
											<input class="form-control" type="date" name="examStartDate" required>
										</div>
										<div class="col-md-4">
											<label>시험 마감일</label>
										</div>
										<div class="col-md-8 form-group">
										<input class="form-control" type="date" name="examEndDate" required>
										</div>
										<div class="col-md-4">
											<label>시험 응시 시간</label>
										</div>
										<div class="col-md-8 form-group">
										<input class="form-control" type="number" name="examDuration" required value=0>
										</div>
										<div class="col-md-4">
											<label>시험 총 문항수</label>
										</div>
										<div class="col-md-8 form-group">
										<input class="form-control" type="number" name="examTotalQuestion" required value=0>
										</div>
										<div class="col-md-4">
											<label>시험 총 배점</label>
										</div>
										<div class="col-md-8 form-group">
										<input class="form-control" type="number" name="examTotalScore" required value=0>
										</div>
									</div>
								</div>
								 <div class="col-sm-12 d-flex justify-content-end">
                    <button type="button" th:onclick="saveExamInfo" class="saveBtn btn btn-primary me-1 mb-1">저장하기</button>
                    <button type="reset" class="btn btn-light-secondary me-1 mb-1">취소</button>
                </div>
							</form>
						</div>
					</div>
				</div>
			</div>
			<div class="card paging offPage">
				<div class="row">
					<th:block
						th:replace="/layout/fragments/professor-eclass/testList :: testListFragment">
					</th:block>
				</div>
			</div>
			<div class="card paging offPage">
				<th:block
					th:replace="/layout/fragments/professor-eclass/makeTest :: makeTestFragment">
				</th:block>
			</div>
		</div>
		<script th:inline="javascript">
			
			$(function() {
				showPage();
				saveExamInfo(); 
				enterDate(); 
			})
			
			// 탭 형식으로 보이기
			function showPage() {
			let icons = $("input[name=tabs]");
			$(icons).each((index, val) => {
				$(val).on("click", function(e) {
					if ($(val).is(":checked")) {
						let page = $(".paging");
						$(page).each((idx, val) => {
							$(val).addClass('offPage');
						})
						$(page[index]).removeClass("offPage");
					}
				})
			})
			}
			
			// 시험 시작/마감 날짜 주차 기준으로 자동 불러오기
			function enterDate() {
				$(document).on("change", "select[name=weekCode]", function(e) {
					let startDate = $($(e.target).children(":selected")).data("start");
					let endDate = $($(e.target).children(":selected")).data("end");
					$("input[name=examStartDate]").val(startDate);
					$("input[name=examEndDate]").val(endDate);
				})
			}
			
			// 시험 정보 저장
			function saveExamInfo() {
				$(".saveBtn").click(function() {
					$.ajax({
						type : 'POST',
						url : 'examInsert',
						contentType : 'application/x-www-form-urlencoded; charset=UTF-8',
						data : $("#examInfoForm").serialize(),
						success : function(result) {
							console.log(result);
						}
					})
				})
			}
			
			</script>
	</th:block>
</body>
</html>