<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/student-eclass_layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<th:block layout:fragment="studentEclassContent">
		<div id="main">
			<div class="page-title">
				<h2>과제 목록</h2>
				</div>
				<div class="card">
				<div class="card height-sevenh">
					<div class="card-body">
					<form name="searchForm" action="/student/eclass/reportList">
					
					<select id="type"  name="type">
			<option th:selected="${pageMaker.cri.type} == '1'" value="1">1주차</option>
			<option th:selected="${pageMaker.cri.type} == '2'" value="2">2주차</option>
			<option th:selected="${pageMaker.cri.type} == '3'" value="3">3주차</option>
			<option th:selected="${pageMaker.cri.type} == '4'" value="4">4주차</option>
			<option th:selected="${pageMaker.cri.type} == '5'" value="5">5주차</option>
			<option th:selected="${pageMaker.cri.type} == '6'" value="6">6주차</option>
			<option th:selected="${pageMaker.cri.type} == '7'" value="7">7주차</option>
			<option th:selected="${pageMaker.cri.type} == '8'" value="8">8주차</option>
			<option th:selected="${pageMaker.cri.type} == '9'" value="9">9주차</option>
			<option th:selected="${pageMaker.cri.type} == '10'" value="10">10주차</option>
			<option th:selected="${pageMaker.cri.type} == '11'" value="11">11주차</option>
			<option th:selected="${pageMaker.cri.type} == '12'" value="12">12주차</option>
			<option th:selected="${pageMaker.cri.type} == '13'" value="13">13주차</option>
			<option th:selected="${pageMaker.cri.type} == '14'" value="14">14주차</option>
			<option th:selected="${pageMaker.cri.type} == '15'" value="15">15주차</option>
		</select>
		
		<input type="hidden" name="pageNum" th:value="${pageMaker.cri.pageNum}">
		<input type="hidden" name="amount" th:value="${pageMaker.cri.amount}">
		
		<button class="saveBtn btn btn-primary me-1 mb-1 search">검색</button>
		<button type="button" class="saveBtn btn btn-primary me-1 mb-1"
		onclick="location.href='/student/eclass/reportList'">전체목록조회</button>
		
		</form>
		
		<br>
		<br>
						<table class="table table-hover" style="text-align : center; width:100%;">
							<thead class="thead-primary">
							<tr>
								<th>번호</th>
								<th>제목</th>
								<th>주차</th>
								<th>과제시작일</th>
								<th>과제마감일</th>
								<th>제출</th>
								<th>첨부파일</th>
								<th>점수</th>
								<th>이의신청</th>
								<th>이의신청여부</th>
							</tr>
							</thead>
							<tbody class="tbody-center">
							<tr th:each="reportList : ${reportList}">
								<td th:text="${reportList.reportNo}"></td>
								<td th:text="${reportList.reportTitle}"></td>
								<td th:text="${reportList.weekNum}"></td>
								<td
									th:text="${#dates.format(reportList.reportStartDate, 'yyyy-MM-dd')}"></td>
								<td
									th:text="${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')}"></td>
								<!-- 과제 마감일이 지나지않은경우 제출버튼표시  -->
								<th:block>
								<td
									th:if="(${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')} >
						 			${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')}) AND (${reportList.reportSubmissionOption == 'UNSUB'})">
									<button
										class="saveBtn btn btn-primary me-1 mb-1 reportSubmitPage"
										th:data-reportcode="${reportList.reportCode}">제출</button>
										<td th:if="(${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')} >
									 ${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')}) AND (${reportList.reportSubmissionOption == 'SUB'})">
									<button
										class="saveBtn btn btn-primary me-1 mb-1 reportModPage"
										th:data-reportcode="${reportList.reportCode}">수정</button> 
								</td>
								</th:block>
								
								
							
								<!-- 과제 마감일이 지난경우 제출된 경우 O 아니면 X -->
								<th:block
									th:unless="${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')} 
									> ${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')}">
									<td th:if="${reportList.reportFileCode == null}">X</td>
									<td th:if="${reportList.reportFileCode != null}">O</td>
								</th:block>

								<td><a
									th:href="@{/report/download/{reportFileCode}/{userCode}(reportFileCode=${reportList.reportFileCode}, userCode=${reportList.userCode})}"
									th:text="${reportList.reportFileName}"
									th:download="${reportList.reportFileName}"></a></td>
									
								<td th:text="${reportList.reportScore}"></td>

								<!-- 이의 신청 -->
								<td th:if="${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')} < ${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')}">
									<button
										class="saveBtn btn btn-primary me-1 mb-1 reportObjection"
										th:disabled="${reportList.reportScoreObjectionApprovalOption == 'A01' || reportList.reportScoreObjectionApprovalOption == 'A00'
										|| reportList.reportFileCode == null}"
										th:data-reportcode="${reportList.reportCode}">이의신청</button>
								</td>
								<td th:unless="${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')} < ${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')}">
									-
								</td>

								<th:block>
									<td th:if="${reportList.reportScoreObjectionApprovalOption == 'A01'}">심사대기</td>
									<td th:if="${reportList.reportScoreObjectionApprovalOption == 'A00'}">승인</td>
									<td th:if="${reportList.reportScoreObjectionApprovalOption == null}">-</td>
								</th:block>

							</tr>

						</tbody>
						</table>
						<br>
				<div th:object="${pageMaker}">
						<ul class="pagination justify-content-center">
						<th:block th:if="${pageMaker.prev}">
   						 <li class="page-item prev">
        				<a class="page-link" href="javascript:void(0)" th:onclick="movePagination([[${#httpServletRequest.requestURI}]], [[${pageMaker.cri.getLink(pageMaker.startPage - 1 , pageMaker.cri.amount, pageMaker.cri.type, pageMaker.cri.keyword)}]])">이전</a>
   						 </li>
						</th:block>
						<th:block th:with="pageMaker = ${pageMaker}">
				    <th:block th:each="num : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
				        <li class="page-item" th:classappend="${pageMaker.cri.pageNum == num} ? 'active' : ''">
				            <a class="page-link" href="javascript:void(0)" th:text="${num}" th:onclick="movePagination([[${#httpServletRequest.requestURI}]], [[${pageMaker.cri.getLink(num, pageMaker.cri.amount, pageMaker.cri.type, pageMaker.cri.keyword)}]])"></a>
				        </li>
				    </th:block>
				    <th:block th:if="${pageMaker.next}">
					    <li class="page-item next">
					        <a class="page-link" href="javascript:void(0)" th:onclick="movePagination([[${#httpServletRequest.requestURI}]], [[${pageMaker.cri.getLink(pageMaker.endPage + 1 , pageMaker.cri.amount, pageMaker.cri.type, pageMaker.cri.keyword)}]])">다음</a>
					    </li>
						</th:block>
						</th:block>
						</ul>
					</div>

					</div>
				</div>
			</div>
		</div>

		<script th:inline="javascript">
		$(function() {
		})
			
			// 검색 버튼 처리 
			$('.search').on("click" , function() {
				//(검색 처리시 페이지번호 1로 가도록)
				$('input[name=pageNum]').val('1')
			
			
			}) 
			
			// 제출 페이지 이동 버튼
			$('.reportSubmitPage').on("click", function() {
				let reportCode = ($(this).data("reportcode"));
				console.log(reportCode)
				location.href = "/student/eclass/reportSubmit/" + reportCode

			})
			
			// 수정 페이지 이동
			$('.reportModPage').on("click", function() {
				let reportCode = ($(this).data("reportcode"));
				console.log(reportCode)
				location.href = "/student/eclass/reportModify/" + reportCode

			})

			//이의 신청 페이지 이동 버튼
			$('.reportObjection').on("click", function() {
				let reportcode = ($(this).data("reportcode"));
				location.href = "/student/eclass/reportObjection/" + reportcode

			})
		</script>
	</th:block>
</body>
</html>