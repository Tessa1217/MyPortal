<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/student-eclass_layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<th:block layout:fragment="studentEclassContent">
		<div id="main">
			<div class="page-title">
				<h2>과제 목록</h2>
				<hr>
				<div class="card">
					<div class="card-body">
					<form name="frmsearch" action="/student/eclass/reportList">
					
					<select id="weekNum"  name="weekNum">
			<option value="1">1주차</option>
			<option value="2">2주차</option>
			<option value="3">3주차</option>
			<option value="4">4주차</option>
			<option value="5">5주차</option>
			<option value="6">6주차</option>
			<option value="7">7주차</option>
			<option value="8">8주차</option>
			<option value="9">9주차</option>
			<option value="10">10주차</option>
			<option value="11">11주차</option>
			<option value="12">12주차</option>
			<option value="13">13주차</option>
			<option value="14">14주차</option>
			<option value="15">15주차</option>
		</select>
		
		<button type="submit" class="saveBtn btn btn-primary me-1 mb-1">검색</button>
		<button type="button" class="saveBtn btn btn-primary me-1 mb-1"
		onclick="location.href='/student/eclass/reportList'">전체목록조회</button>
		
		</form>
		
		<br>
		<br>
						<table class="table">
							<tr>
								<th>번호</th>
								<th>제목</th>
								<th>주차</th>
								<th>과제시작일</th>
								<th>과제마감일</th>
								<th>제출</th>
								<th>첨부파일</th>
								<th>이의신청</th>
								<th>이의신청여부</th>
							</tr>

							<tr th:each="reportList, idx : ${reportList}">
								<td th:text="${idx.index+1}"></td>
								<td th:text="${reportList.reportTitle}"></td>
								<td th:text="${reportList.weekNum}"></td>
								<td
									th:text="${#dates.format(reportList.reportStartDate, 'yyyy-MM-dd')}"></td>
								<td
									th:text="${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')}"></td>
								<!-- 과제 마감일이 지나지않은경우 제출버튼표시  -->
								<td
									th:if="${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')} >
						 ${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')} ">
									<button
										class="saveBtn btn btn-primary me-1 mb-1 reportSubmitPage"
										th:data-reportcode="${reportList.reportCode}">제출</button>
								</td>
								<!-- 과제 마감일이 지난경우 제출된 경우 O 아니면 X -->
								<th:block
									th:unless="${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')} 
									> ${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')}">
									<td th:if="${reportList.reportSubmissionOption == 'UNSUB'}">X</td>
									<td th:if="${reportList.reportSubmissionOption == 'SUB'}">O</td>
								</th:block>

								<td><a
									th:href="@{/report/download/{reportFileCode}/{userCode}(reportFileCode=${reportList.reportFileCode}, userCode=${reportList.reportFile.userCode})}"
									th:text="${reportList.reportFile.reportFileName}"
									th:download="${reportList.reportFile.reportFileName}"></a></td>

								<!-- 이의 신청 -->
								<td th:if="${#dates.format(reportList.reportEndDate, 'yyyy-MM-dd')} < ${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')}">
									<button
										class="saveBtn btn btn-primary me-1 mb-1 reportObjection"
										th:disabled="${reportList.reportScoreObjectionApprovalOption == 'A01' || reportList.reportScoreObjectionApprovalOption == 'A00'
										|| reportList.reportSubmissionOption == 'UNSUB'}"
										th:data-reportcode="${reportList.reportCode}">이의신청</button>
								</td>

								<th:block>
									<td th:if="${reportList.reportScoreObjectionApprovalOption == 'A01'}">심사대기</td>
									<td th:if="${reportList.reportScoreObjectionApprovalOption == 'A00'}">승인</td>
								</th:block>

							</tr>


						</table>

					</div>
				</div>
			</div>
		</div>

		<script th:inline="javascript">
			// 제출 페이지 이동 버튼
			$('.reportSubmitPage').on("click", function() {
				let reportCode = ($(this).data("reportcode"));
				console.log(reportCode)
				location.href = "/student/eclass/reportSubmit/" + reportCode

			})

			//이의 신청 페이지 이동 버튼
			$('.reportObjection').on("click", function() {
				let reportcode = ($(this).data("reportcode"));
				location.href = "/student/eclass/reportObjection/" + reportcode

			})
		</script>
	</th:block>
</body>
</html>