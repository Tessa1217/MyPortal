<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/student_layout}">

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
</head>

<body>
	<th:block layout:fragment="studentContent">
		<div id="main">
			<h2>수강 신청</h2>
			<hr>
			<!-- 학생 정보 -->
			<div>
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>학번</th>
							<th>성명</th>
							<th>학년</th>
							<th>대학</th>
							<th>전공</th>
							<th>신청 가능학점</th>
							<th>교양 신청 가능학점</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="item:${studentInfo}">
							<td th:text="${item.studentId}"></td>
							<td th:text="${item.studentName}"></td>
							<td th:text="${item.studentGrade}"></td>
							<td th:text="${item.collegeName}"></td>
							<td th:text="${item.departName}"></td>
							<td>20</td>
							<td>5</td>
						</tr>
					</tbody>
				</table>
			</div>
			<h4>개설강의 LIST</h4>
			<br>
			<!-- 학과별 강의 검색 -->
			<form name="frmchoice">
				<select id="departCode" name="departCode">
					<option selected>--- 학과선택 ---</option>
					<optgroup label="인문대학">
						<option value="JAPA">일어일문학과</option>
						<option value="ENGL">영어영문학과</option>
					</optgroup>
					<optgroup label="사회과학대학">
						<option value="PSYC">심리학과</option>
					</optgroup>
					<optgroup label="자연과학대학">
						<option value="BIOL">생물학과</option>
						<option value="CHEM">화학공학과</option>
						<option value="PHYS">물리학과</option>
					</optgroup>
					<optgroup label="소프트웨어대학">
						<option value="ELEG">전기공학과</option>
					</optgroup>
				</select>
				<button class="btn rounded-pill btn-primary" type="submit">검색</button>
				<button class="btn rounded-pill btn-primary" type="button" onclick="location.href='courseRegister'">초기화</button>
			</form>
			<br>
			<form name="frm">
				<input id="makeBtn" type="text" size="18" name="output" placeholder="자동신청 방지코드">
				<input type="button" value="코드 생성" onClick="populateform(this.form.thelength.value)"
					class="btn rounded-pill btn-primary">
				<input type="text" size="18" name="che" id="regBtn">
				<input type="button" value="확인" onClick="check()"	class="btn rounded-pill btn-primary" disabled>
				<b hidden="">문자 길이:</b><input type="text" name="thelength" size="3" value="5" hidden="">
			</form>
			<br>
			<!-- 강의 리스트 -->
			<div class="overflow-auto" style="max-height: 300px;">
				<table class="table table-bordered table-hover" id="ListTable">
					<thead>
						<tr>
							<th>강의 코드</th>
							<th>이수 구분</th>
							<th>강의명</th>
							<th>학점</th>
							<th>담당 교수</th>
							<th>신청 인원</th>
							<th>수강 정원</th>
							<th>신청</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="item:${registerList}">
							<td th:text="${item.courseCode}"></td>
							<td th:text="${item.courseSortation}"></td>
							<td th:text="${item.courseName}"></td>
							<td th:text="${item.courseCredit}"></td>
							<td th:text="${item.professorName}"></td>
							<td th:text="${item.studentCount}"></td>
							<td th:text="${item.courseLimit}"></td>
							<td><button type="button"
								class="btn btn-primary buttonRegister"
								th:data-code="${item.courseCode}">신청</button></td>
						</tr>
					</tbody>
				</table>
			</div>
			<br>
			<hr>
			<!-- 꾸러미 실패 내역 및 신청 리스트 -->
			<div>
				<h4>수강꾸러미 내역</h4>
				<div>
					<table class="table table-bordered">
						<thead>
							<tr>
								<th>과목 코드</th>
								<th>이수 구분</th>
								<th>강의명</th>
								<th>학점</th>
								<th>담당 교수</th>
								<th>신청 인원</th>
								<th>수강 정원</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="item:${packageNList}">
								<td th:text="${item.courseCode}"></td>
								<td th:text="${item.courseSortation}"></td>
								<td th:text="${item.courseName}"></td>
								<td th:text="${item.courseCredit}"></td>
								<td th:text="${item.professorName}"></td>
								<td th:text="${item.studentCount}"></td>
								<td th:text="${item.courseLimit}"></td>
							</tr>
						</tbody>
					</table>
				</div>
				<br>
				<!-- 신청 성공 리스트 -->
				<div>
					<h4 style="display: inline;">신청과목 LIST</h4>
					<h6 style="display: inline;">신청가능 학점:<span
							th:text="!${coursePackagePoint}?20:20-${coursePackagePoint.packageCredit}"></span></h6>
					<h6 style="display: inline;">전공학점:</h6>
					<h6 style="display: inline;">교양학점:</h6>
					<table class="table table-bordered">
						<thead>
							<tr>
								<th>과목 코드</th>
								<th>이수 구분</th>
								<th>강의명</th>
								<th>학점</th>
								<th>담당 교수</th>
								<th>신청 취소</th>
							</tr>
						</thead>
						<tbody id="rBody">
							<tr th:each="item:${successList}">
								<td th:text="${item.courseCode}"></td>
								<td th:text="${item.courseSortation}"></td>
								<td th:text="${item.courseName}"></td>
								<td th:text="${item.courseCredit}"></td>
								<td th:text="${item.professorName}"></td>
								<td><button type="button"
								class="btn btn-primary buttonDelete"
								th:data-code="${item.courseCode}">취소</button></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<script th:inline="javascript">

		</script>

		<script th:inline="javascript">
			var keyList = "abcdefABCDEF0123456789"
			var temp = ''
			function generatepass(plength) {
				temp = ''
				for (i = 0; i < plength; i++)
					temp += keyList.charAt(Math.floor(Math.random() * keyList.length))
				return temp
			}
			function populateform(enterlength) {
				document.frm.output.value = generatepass(enterlength)
			}
			function check() {
				if (!document.frm.che.value) {
					return alert('자동방지코드를 입력하세요');
				} else {
					return alert('다시입력해주세요');
				}
			}

			$(function(){
				$(".buttonRegister").on("click", registerInsert)
				function registerInsert(){
					let code = $(this).data("code");
					
					$.ajax({
						url:"/student/registerInsert",
						method:"post",
						dataType:"json",
						data:{
							"courseCode" : code
						},
						dataType:"json",
						success:function(item){
							let content=`<tr>
								<td>${item.courseCode}</td>
								<td>${item.courseSortation}</td>
								<td>${item.courseName}</td>
								<td>${item.courseCredit}</td>
								<td>${item.professorName}</td>
								<td><button type="button"
								class="btn btn-primary buttonDelete"
								data-code="${item.courseCode}">취소</button></td>
							</tr>`;

						$("#rBody").append(content);	

						location.reload;
						}
					});
				}
			})


		</script>
	</th:block>
</body>

</html>